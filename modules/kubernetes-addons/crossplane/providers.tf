provider "aws" {
  region = "us-west-2"
  alias  = "default"
}

provider "kubernetes" {
    host                   = "https://01AB9AF51D9F0D05EEE7DF7457E5EA49.gr7.us-west-2.eks.amazonaws.com"
    cluster_ca_certificate = base64decode("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1ERXdOREl3TlRVeE1Wb1hEVE16TURFd01USXdOVFV4TVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTDhFCkp1WWFSQ0Ezcnd4R3BXZXV2dDhvWWlBUDlNNVBPemZLS2RRR1VnR01TTUZLQkw5SVAvcG51UU5EZWFzN2lyd1QKOXI4STA3K1MvYnpQSWZzZWIrYmRmVGd0a0kwT2c4VDdmRG4vcmhKbUFnRGwyeXlzQ0ZEcVNaUmp2dmk4VnNQawo4ODRwYmNnMmhLSW1JeW1SUzB6bFUyUUFZNFFCb0tVMWNCdDdXam9oQ29qS2J0cFRFbDBqRDl5ejdQMUxBUWhhCnQwMDJabHlLNnhFOUhCMitJQVdHZDBheWlieXFJTGQ2c0NUWW8yVXkwbW5LK0FBY3dibFc2WkdLZitqUUtvcHIKZGRzcEtUc1N0WXJuczQ3SGVUdUZMTFFrWUJGaThKVHhkQ0prQzZWekViTDkrbUlRcmxBb3dBQ3Q2YlpuQnlaTQp6RUpreG80RFZIMldIM3BPeDIwQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZEUmFuNy8rbTMzSHRhbUhvS0cwVU10YTR3S2JNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSzhrN0psdnluSjdteHpTZjJMZwpoU1hsdEYvY3pUZndlVkUzS1p0Q3lHMkFEaWxkT0tmSWpMWkdPcDRYMmlYUlA2SG9DNVRiNGEvSTVJRDVLYVdyCmhpam0xcUpXNXE4UjhEUVF5WU92LzVYYnU1cDNMM1BORzJmbkNER2lFZ0IwUXQwMW50eEgwQXhUTXR3bi9GY0QKaWJYMmk2VWJITXNZNkl5a3IybE9ZZkQxZmlNM3RYOVYyaGp0ejE1TkFJYVlsdXkxam1LRUkxRyt2V09RMHdsTgpFNGhaMEZ6dmw5TFZsV292TTZ0Z3B6UlFmV204Ri9wWXdFcmJvQkRPQWtMZEgyZ09obDVkWlR4TUwxV0FwOCtoCm1jMDNMNWZaN3pGajIrRHVsNHhVVlJBZXRXV0FGc3RDbjF5Tm82WUFMRkgweHQ2UlVMVE9sWk1za0lzZTZTWGUKT1hzPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==")

  exec {
    api_version = "client.authentication.k8s.io/v1beta1"
    command     = "aws"
    # This requires the awscli to be installed locally where Terraform is executed
    args = ["eks", "get-token", "--cluster-name", "bersr"]
  }
}

provider "helm" {
  kubernetes {
    host                   = "https://01AB9AF51D9F0D05EEE7DF7457E5EA49.gr7.us-west-2.eks.amazonaws.com"
    cluster_ca_certificate = base64decode("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1ERXdOREl3TlRVeE1Wb1hEVE16TURFd01USXdOVFV4TVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTDhFCkp1WWFSQ0Ezcnd4R3BXZXV2dDhvWWlBUDlNNVBPemZLS2RRR1VnR01TTUZLQkw5SVAvcG51UU5EZWFzN2lyd1QKOXI4STA3K1MvYnpQSWZzZWIrYmRmVGd0a0kwT2c4VDdmRG4vcmhKbUFnRGwyeXlzQ0ZEcVNaUmp2dmk4VnNQawo4ODRwYmNnMmhLSW1JeW1SUzB6bFUyUUFZNFFCb0tVMWNCdDdXam9oQ29qS2J0cFRFbDBqRDl5ejdQMUxBUWhhCnQwMDJabHlLNnhFOUhCMitJQVdHZDBheWlieXFJTGQ2c0NUWW8yVXkwbW5LK0FBY3dibFc2WkdLZitqUUtvcHIKZGRzcEtUc1N0WXJuczQ3SGVUdUZMTFFrWUJGaThKVHhkQ0prQzZWekViTDkrbUlRcmxBb3dBQ3Q2YlpuQnlaTQp6RUpreG80RFZIMldIM3BPeDIwQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZEUmFuNy8rbTMzSHRhbUhvS0cwVU10YTR3S2JNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSzhrN0psdnluSjdteHpTZjJMZwpoU1hsdEYvY3pUZndlVkUzS1p0Q3lHMkFEaWxkT0tmSWpMWkdPcDRYMmlYUlA2SG9DNVRiNGEvSTVJRDVLYVdyCmhpam0xcUpXNXE4UjhEUVF5WU92LzVYYnU1cDNMM1BORzJmbkNER2lFZ0IwUXQwMW50eEgwQXhUTXR3bi9GY0QKaWJYMmk2VWJITXNZNkl5a3IybE9ZZkQxZmlNM3RYOVYyaGp0ejE1TkFJYVlsdXkxam1LRUkxRyt2V09RMHdsTgpFNGhaMEZ6dmw5TFZsV292TTZ0Z3B6UlFmV204Ri9wWXdFcmJvQkRPQWtMZEgyZ09obDVkWlR4TUwxV0FwOCtoCm1jMDNMNWZaN3pGajIrRHVsNHhVVlJBZXRXV0FGc3RDbjF5Tm82WUFMRkgweHQ2UlVMVE9sWk1za0lzZTZTWGUKT1hzPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==")

    exec {
      api_version = "client.authentication.k8s.io/v1beta1"
      command     = "aws"
      # This requires the awscli to be installed locally where Terraform is executed
      args = ["eks", "get-token", "--cluster-name", "bersr"]
    }
  }
}
